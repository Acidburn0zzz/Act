<script type="text/javascript">
if (window.act) {
    toggle_image = function(elem, talk_id, set) {
        var img_name = set ? 'picked' : 'unpicked';
        $(elem).replaceWith(
            $(
                '<img class="mtbutton" src="/images/' + img_name + '.gif"'
              + ' title="remove from my schedule"'
              + ' onClick ="toggle_talk(this,' + talk_id + ',' + set + ');" />'
             )
         )
    };
    toggle_talk = function(elem, talk_id, set) {
        $.post(act.make_uri('[% global.request.conference %]', 'ajax_toggle_mytalk'), {talk_id: talk_id} );
        toggle_image(elem, talk_id, !set);
    };
    $(function() {
        $(".mytalks_submit").hide();
        $(":checkbox").map(function() {
            toggle_image(this, $(this).val(), $(this).attr("checked"));
        });
    });
}
</script>
[% IF not ( global.request.user.is_orga
         or global.request.user.is_staff
         or global.config.talks_show_schedule ) %]
{{The schedule is not ready to be seen.}}
[% ELSE %]
[% IF global.request.user AND global.request.user.has_registered %]
<form method="POST" action="[% make_uri('updatemytalks') %]" />
[% END %]
[% IF todo.size %]
<p>
 {{The time and place of the following talks haven't been decided yet.}}
</p>
<table>
 <tr>
  <th>{{Speaker}}</th>
  <th>{{Talk title}}</th>
  [% IF global.config.talks_languages %]<th>{{Language}}</th>[% END %]
  <th>{{Duration}}</th>
 </tr>
 [% FOREACH t IN todo %]
 <tr>
  <td><a href="[% make_uri_info('user', t.user.user_id) %]">
   [% user_info(t.user) %]
  </a></td>
  <td>[% IF t.type == 'Act::Event' %]
         [% event_link(t) %]
         [% event_modify_link(t) %]
      [% ELSE %]
         [% talk_confirmed_link(t) %]
         [% talk_modify_link(t) %]
      [% END %]
  </td>
  [% IF global.config.talks_languages %]<td>[% global.config.talks_languages.${t.lang} %]</td>[% END %]
  <td>[% t.duration %] {{minutes}}
  </td>
 </tr>
 [% END %]
</table>
<hr />
[% END %]
<p>
{{Talks in bold type have been confirmed by their respective speakers.}}
</p>
[% FOREACH d IN table.keys.sort %]
[% date = d.replace('$', ' 00:00:00' ) %]
<a name="[% d %]"></a>
<h2>[% date_format(date, 'date_full') | ucfirst %]</h2>
<table border="0">
 <tr class="header">
  <th>
   {{Time}}
  </th>
  [% FOREACH r IN room.keys.sort %]
  <th colspan="[% width.$r.$d %]">
    [% global.config.rooms.$r %]
  </th>
  [% END %]
 </tr>
 [% FOREACH row IN table.$d %]
 <tr class="header">
  [% FOREACH col IN row %]
   [% IF loop.first %]
     <td align="center" valign="top" class="header">[% col %]</td>
   [% ELSE %]
     <td valign="top" [% IF col.height AND col.height > 1 %]rowspan="[% col.height %]"[% END %] [% IF col.room %]class="[% col.room %]"[% IF col.room.match('^(?:out|venue)$') %] colspan="[% maxwidth.$d %]"[% END %][% END %]>
       [% timeslot(col) %]
     </td>
   [% END %]
  [% END %]
 </tr>
 [% END %]
</table>
[% END %]
[% IF global.request.user AND global.request.user.has_registered %]
<input type="submit" class="mytalks_submit" value="Submit changes" />
</form>
[% END %]
[% END %]
