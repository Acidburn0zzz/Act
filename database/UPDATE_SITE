-- Stuff to do when upgrading the production server

update talks set track_id = '1' where track_id = 'A';
update talks set track_id = '2' where track_id = 'B';
update talks set track_id = '3' where track_id = 'C';
update talks set track_id = '4' where track_id = 'D';
update talks set track_id = '5' where track_id = 'E';
update talks set track_id = '6' where track_id = 'F';
update talks set track_id = '7' where track_id = 'G';
update talks set track_id = '8' where track_id = 'H';
update talks set track_id = '9' where track_id = 'I';
update talks set track_id = '10' where track_id = 'J';
update talks set track_id = '11' where track_id = 'K';
update talks set track_id = '12' where track_id = 'L';
update talks set track_id = '13' where track_id = 'M';

update tracks set track_id = '1' where track_id = 'A';
update tracks set track_id = '2' where track_id = 'B';
update tracks set track_id = '3' where track_id = 'C';
update tracks set track_id = '4' where track_id = 'D';
update tracks set track_id = '5' where track_id = 'E';
update tracks set track_id = '6' where track_id = 'F';
update tracks set track_id = '7' where track_id = 'G';
update tracks set track_id = '8' where track_id = 'H';
update tracks set track_id = '9' where track_id = 'I';
update tracks set track_id = '10' where track_id = 'J';
update tracks set track_id = '11' where track_id = 'K';
update tracks set track_id = '12' where track_id = 'L';
update tracks set track_id = '13' where track_id = 'M';

create sequence tracks_track_id_seq;
SELECT setval('tracks_track_id_seq', 13);  

alter table events drop column track_id;
alter table talks  alter track_id type integer using track_id::int4;
alter table tracks alter track_id type integer using track_id::int4;
alter table tracks alter track_id set default nextval('tracks_track_id_seq');
alter table tracks add primary key (track_id);
drop index tracks_idx;
create index tracks_idx on tracks(conf_id);
alter table tracks alter title set not null;
alter table talks  add constraint talks_track_id_fkey foreign key (track_id) references tracks(track_id) on delete set null;
